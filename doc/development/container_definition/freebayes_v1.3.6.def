Bootstrap: docker
From: ubuntu:latest

%post
LANG=C.UTF-8
LC_ALL=C.UTF-8
PATH=/bin:$PATH

# update ubuntu packages and install build dependencies
apt-get update
apt-get install -y \
	wget \
	build-essential \
	bc \
	samtools \
	parallel \
	meson \
	ninja-build \
	libvcflib-tools \
	vcftools \
	gcc \
	clang
rm -rf /var/lib/apt/lists/*

# download and build freebayes
mkdir -p /opt/freebayes
cd /opt/freebayes && \
wget -c https://github.com/freebayes/freebayes/releases/download/v1.3.6/freebayes-1.3.6-src.tar.gz && \
tar xzf freebayes-1.3.6-src.tar.gz && \
rm freebayes-1.3.6-src.tar.gz && \
cd freebayes
meson build/ --buildtype release
cd build
ninja
ninja test

# cleanup build dependencies
apt-get remove -y \
	wget \
	build-essential \
	meson \
	ninja-build \
	libvcflib-tools \
	gcc \
	clang
apt-get autoremove -y && \
apt-get clean && \
rm -rf /var/lib/apt/lists/*

%environment
PATH=/opt/freebayes/freebayes/build:$PATH
export LC_ALL=C.UTF-8
export LANG=C.UTF-8