Bootstrap: docker
From: ubuntu:24.04

%post
export LANG=C.UTF-8
export LC_ALL=C.UTF-8
	
# Update and install system dependencies
apt-get update --fix-missing
apt-get upgrade -y
apt-get install -y \
	git \
	cmake \
	build-essential \
	pkg-config \
	gcc \
	libhts-dev \
	libtabixpp-dev \
	libtabixpp0 \
	libbz2-dev \
	perl \
	pybind11-dev \
	python3-dev \
	python3-pip \
	libgomp1

# Download and build vcflib
cd /opt
git clone https://github.com/vcflib/vcflib.git vcflib-1.0.14
cd vcflib-1.0.14
git checkout v1.0.14
git submodule update --recursive --init
cmake -DCMAKE_BUILD_TYPE=Release -DWFA_GITMODULE=ON -DZIG=OFF .
cmake --build .
mkdir -p /opt/vcflib
cmake --install . --prefix /opt/vcflib

# Cleanup build dependencies
cd /
apt-get remove -y \
	git \
	cmake \
	build-essential \
	pkg-config \
	gcc \
	libhts-dev \
	libtabixpp-dev \
	libtabixpp0 \
	libbz2-dev \
	perl
apt-get autoremove -y
apt-get clean
rm -rf /var/lib/apt/lists/* /opt/vcflib-1.0.14

%environment
export LANG=C.UTF-8
export LC_ALL=C.UTF-8
export PATH=/opt/vcflib/bin/:$PATH
export LD_LIBRARY_PATH=/opt/vcflib/lib:$LD_LIBRARY_PATH
